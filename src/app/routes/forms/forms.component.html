<div class="container">
  <mat-expansion-panel class="mt-3"
                       style="background-color: var(--accent-color); border-radius: 12px; overflow:hidden">
    <mat-expansion-panel-header style="height: 40px">
      <mat-panel-title style="color: white !important; font-size: 15px">Start a new form</mat-panel-title>
    </mat-expansion-panel-header>

    <form [formGroup]="formGroup" (ngSubmit)="onSubmitStartNewForm()">
      <mat-form-field class="w-100">
        <mat-label>Select a form</mat-label>
        <mat-select formControlName="templateIdCtrl">
          @for (template of templates; track template.id) {
            <mat-option [value]="template.id">{{ template.title }} - {{ template.description }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <button mat-flat-button color="primary" type="submit" [disabled]="formGroup.invalid">
        Start Form
      </button>

    </form>
  </mat-expansion-panel>

  <div class="row mx-3 my-3">
    <div class="line-with-button">
      <div class="line"></div>
      <span>or</span>
      <div class="line"></div>
    </div>
  </div>

  <div class="toggle-wrapper">
    <div class="toggle-container">
      <button
        class="toggle-btn"
        [class.active]="selectedTab === 'my-forms'"
        (click)="selectedTab = 'my-forms'">
        My forms
      </button>
      <button
        class="toggle-btn"
        [class.active]="selectedTab === 'assigned-forms'"
        (click)="selectedTab = 'assigned-forms'">
        Assigned forms
      </button>
    </div>
  </div>

  <ng-container
    *ngIf="selectedTab === 'my-forms'">
    <ng-container
      *ngTemplateOutlet="formList; context: { forms: myForms, isMyForms: true, isAssigned: false }">
    </ng-container>
  </ng-container>

  <ng-container
    *ngIf="selectedTab === 'assigned-forms'">
    <ng-container
      *ngTemplateOutlet="formList; context: { forms: assignedForms, isMyForms: false, isAssigned: true  }">
    </ng-container>
  </ng-container>
</div>


<ng-template #formList let-forms="forms" let-isMyForms="isMyForms" let-isAssigned="isAssigned">

  <div *ngFor="let form of forms; index as sectionIndex">
    <div class="card-border-radius bg-white mt-3 px-3 py-2">
      <div class="d-flex flex-column">
        <span style="font-size: 22px"><b>{{ form.template.title }}</b></span>
        <label style="font-size: 15px; color: var(--label-color)">{{ form.template.description }}</label>
      </div>
      <div class="my-2" style="height:2px; background-color:var(--border-color)">
      </div>
      <div>
        <div><span>Company: {{ form.template.companyName }}</span></div>
        <div><span>Status:</span><span [innerHTML]="getStatus(form)"></span></div>
        <div><span>Last modified date: {{ form.lastModifiedDate }}</span></div>
        <div><span>Created date: {{ form.createdDate }}</span></div>
        <div><span>Created by: {{ form.creatorUser.lastname }} {{ form.creatorUser.firstname }}</span></div>
      </div>

      <button type="button" mat-button class="mt-3"
              style="color: white; background-color: var(--accent-color); padding-left: 20px; padding-right: 20px;
border-radius: 12px; height: 40px !important;"
              (click)="openForm(form)">
        Open
      </button>
    </div>
  </div>
</ng-template>
